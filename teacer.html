<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>先生用（親機）</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
        }
    </style>
</head>

<body>
    <h1>👨‍🏫 先生の待合室</h1>
    <p>黒板にこのIDを書いてください: <strong id="room-id" style="font-size: 24px; color: blue;">取得中...</strong></p>

    <button id="start-btn" disabled
        style="padding: 15px 30px; font-size: 20px; background: #ff4c4c; color: white; border: none; border-radius: 5px; cursor: pointer;">
        全員一斉スタート！
    </button>

    <h2>参加中の生徒</h2>
    <ul id="student-list" style="font-size: 20px;"></ul>

    <script>
        const peer = new Peer(); // 仲介役（シグナリング）に接続
        const connections = [];  // 繋がった生徒のリスト

        // 自分のID（部屋番号）が発行されたら画面に表示
        peer.on('open', (id) => {
            document.getElementById('room-id').innerText = id;
        });

        // 生徒から直接通信が繋がった時の処理
        peer.on('connection', (conn) => {
            connections.push(conn);
            document.getElementById('start-btn').disabled = false; // ボタンを押せるようにする

            // 生徒からデータ（名前）が送られてきた時の処理
            conn.on('data', (data) => {
                const li = document.createElement('li');
                li.innerText = data + " さんが参加しました！";
                document.getElementById('student-list').appendChild(li);
            });
        });

        // スタートボタンを押した時の処理
        document.getElementById('start-btn').onclick = () => {
            connections.forEach(conn => {
                conn.send("START"); // 繋がっている全員に「START」という文字を直接発射！
            });
        };
    </script>
</body>

</html>